<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>template | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Head 数据结构 并查集 树状数组 线段树 1.李超树 扫描线 1.扫描线求矩形面积交   (待补)线段树合并 (待补)动态开点线段树 (待补)ZKW线段树 (待补)吉司机线段树   可持久化线段树(主席树) 模板 1.静态区间Kth (待补) 2.区间修改(标记永久化) &amp;amp; 历史版本询问 hdu4348 (待补) 3.单点修改 区间Kth(树状数组套主席树)     平衡树 1.">
<meta property="og:type" content="article">
<meta property="og:title" content="template">
<meta property="og:url" content="http://yoursite.com/2019/08/22/temp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Head 数据结构 并查集 树状数组 线段树 1.李超树 扫描线 1.扫描线求矩形面积交   (待补)线段树合并 (待补)动态开点线段树 (待补)ZKW线段树 (待补)吉司机线段树   可持久化线段树(主席树) 模板 1.静态区间Kth (待补) 2.区间修改(标记永久化) &amp;amp; 历史版本询问 hdu4348 (待补) 3.单点修改 区间Kth(树状数组套主席树)     平衡树 1.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-08-22T02:07:06.003Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="template">
<meta name="twitter:description" content="Head 数据结构 并查集 树状数组 线段树 1.李超树 扫描线 1.扫描线求矩形面积交   (待补)线段树合并 (待补)动态开点线段树 (待补)ZKW线段树 (待补)吉司机线段树   可持久化线段树(主席树) 模板 1.静态区间Kth (待补) 2.区间修改(标记永久化) &amp;amp; 历史版本询问 hdu4348 (待补) 3.单点修改 区间Kth(树状数组套主席树)     平衡树 1.">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-temp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/22/temp/" class="article-date">
  <time datetime="2019-08-22T01:45:46.000Z" itemprop="datePublished">2019-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      template
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->

<ul>
<li><a href="#head">Head</a></li>
<li><a href="#数据结构">数据结构</a><ul>
<li><a href="#并查集">并查集</a></li>
<li><a href="#树状数组">树状数组</a></li>
<li><a href="#线段树">线段树</a><ul>
<li><a href="#1李超树">1.李超树</a></li>
<li><a href="#扫描线">扫描线</a><ul>
<li><a href="#1扫描线求矩形面积交">1.扫描线求矩形面积交</a></li>
</ul>
</li>
<li><a href="#待补线段树合并">(待补)线段树合并</a></li>
<li><a href="#待补动态开点线段树">(待补)动态开点线段树</a></li>
<li><a href="#待补zkw线段树">(待补)ZKW线段树</a></li>
<li><a href="#待补吉司机线段树">(待补)吉司机线段树</a></li>
</ul>
</li>
<li><a href="#可持久化线段树主席树">可持久化线段树(主席树)</a><ul>
<li><a href="#模板">模板</a><ul>
<li><a href="#1静态区间kth">1.静态区间Kth</a></li>
<li><a href="#待补-2区间修改标记永久化--历史版本询问-hdu4348">(待补) 2.区间修改(标记永久化) &amp; 历史版本询问 hdu4348</a></li>
<li><a href="#待补-3单点修改-区间kth树状数组套主席树">(待补) 3.单点修改 区间Kth(树状数组套主席树)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#平衡树">平衡树</a><ul>
<li><a href="#1splay">1.Splay</a></li>
<li><a href="#2treap">2.Treap</a></li>
<li><a href="#3fhq_treap非旋treap">3.FHQ_treap(非旋Treap)</a></li>
<li><a href="#待补4替罪羊树">(待补)4.替罪羊树</a></li>
<li><a href="#待补5可持久化平衡树">(待补)5.可持久化平衡树</a></li>
</ul>
</li>
<li><a href="#待补lct">(待补)LCT</a></li>
<li><a href="#待补可并堆">(待补)可并堆</a></li>
<li><a href="#单调栈--单调队列">单调栈 &amp; 单调队列</a></li>
<li><a href="#树链剖分">树链剖分</a><ul>
<li><a href="#1重链剖分">1.重链剖分</a></li>
<li><a href="#待补2长链剖分">(待补)2.长链剖分</a></li>
</ul>
</li>
<li><a href="#rmq--二维rmq-st表">RMQ &amp; 二维RMQ (ST表)</a><ul>
<li><a href="#1一维st表">1.一维ST表</a></li>
<li><a href="#2二维st表">2.二维ST表</a></li>
</ul>
</li>
<li><a href="#待补莫队">(待补)莫队</a></li>
<li><a href="#待补分块">(待补)分块</a></li>
<li><a href="#待补cdq分治">(待补)CDQ分治</a></li>
<li><a href="#待补整体二分">(待补)整体二分</a></li>
<li><a href="#树套树">树套树</a><ul>
<li><a href="#1线段树套线段树">1.线段树套线段树</a></li>
<li><a href="#2树状数组套主席树">2.树状数组套主席树</a></li>
<li><a href="#3线段树套平衡树">3.线段树套平衡树</a></li>
<li><a href="#待补4平衡树套线段树">(待补)4.平衡树套线段树</a></li>
</ul>
</li>
<li><a href="#待补kd-tree">(待补)KD-Tree</a></li>
<li><a href="#待补动态kd-tree">(待补)动态KD-Tree</a></li>
</ul>
</li>
<li><a href="#图论">图论</a></li>
<li><a href="#字符串">字符串</a><ul>
<li><a href="#字符串哈希">字符串哈希</a><ul>
<li><a href="#模板-1">模板</a><ul>
<li><a href="#1自然溢出">1.自然溢出</a></li>
<li><a href="#2二维矩阵hash">2.二维矩阵hash</a></li>
<li><a href="#3双hash">3.双hash</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kmp">KMP</a><ul>
<li><a href="#资料">资料</a></li>
<li><a href="#模板-2">模板</a></li>
<li><a href="#应用">应用</a><ul>
<li><a href="#1求字符串的最小循环节">1.求字符串的最小循环节</a></li>
<li><a href="#2求字符串-s-每一个前缀在字符串-t-中的出现次数">2.求字符串 $S$ 每一个前缀在字符串 $T$ 中的出现次数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#扩展kmp">扩展kmp</a><ul>
<li><a href="#资料-1">资料</a></li>
<li><a href="#模板-3">模板</a></li>
</ul>
</li>
<li><a href="#字符串最小表示法">字符串最小表示法</a><ul>
<li><a href="#循环同构">循环同构</a></li>
<li><a href="#最小表示">最小表示</a></li>
<li><a href="#资料-2">资料</a></li>
<li><a href="#模板-4">模板</a></li>
</ul>
</li>
<li><a href="#manacher">manacher</a></li>
<li><a href="#ac自动机">AC自动机</a><ul>
<li><a href="#1求以文本串每个位置匹配的模式串个数">1.求以文本串每个位置匹配的模式串个数</a></li>
<li><a href="#2求每个模式串的出现次数">2.求每个模式串的出现次数</a></li>
</ul>
</li>
<li><a href="#后缀数组">后缀数组</a><ul>
<li><a href="#数组含义">数组含义</a></li>
<li><a href="#性质">性质</a></li>
<li><a href="#资料-3">资料</a></li>
<li><a href="#模板-5">模板</a></li>
<li><a href="#统计字符串中相同的子串的对数-或-字符串中每一对后缀的lcp之和">统计字符串中相同的子串的对数 或 字符串中每一对后缀的LCP之和</a><ul>
<li><a href="#模板-6">模板</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#数学--数论">数学 &amp; 数论</a><ul>
<li><a href="#gcd--exgcd">GCD &amp; EXGCD</a></li>
<li><a href="#"></a></li>
<li><a href="#快速幂">快速幂</a></li>
<li><a href="#因子求和">因子求和</a></li>
<li><a href="#线性筛素数">线性筛素数</a></li>
<li><a href="#阶乘分解质因数">阶乘分解质因数</a></li>
<li><a href="#fft">FFT</a><ul>
<li><a href="#资料-4">资料</a></li>
<li><a href="#模板-7">模板</a><ul>
<li><a href="#1常规">1.常规</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->

<h1 id="Head"><a href="#Head" class="headerlink" title="Head"></a>Head</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ULL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; pr;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;LL, LL&gt; lpr;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">double</span>, <span class="keyword">double</span>&gt; dpr;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;ULL, ULL&gt; upr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> next_x[<span class="number">8</span>] = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>,<span class="number">-1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> next_y[<span class="number">8</span>] = &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">-1</span>,<span class="number">-1</span>, <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">2147483647</span>;</span><br><span class="line"><span class="keyword">const</span> LL linf = <span class="number">1e15</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL t = <span class="number">0</span>, f = <span class="number">1</span>; <span class="keyword">char</span> ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (ch&lt;<span class="string">'0'</span> || ch&gt;<span class="string">'9'</span>) &#123; <span class="keyword">if</span> (ch == <span class="string">'-'</span>)f = <span class="number">-1</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span>&amp;&amp;ch &lt;= <span class="string">'9'</span>) &#123; t = t * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar(); &#125;</span><br><span class="line">    <span class="keyword">return</span> t * f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(LL x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">'-'</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=<span class="number">10</span>) write(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">'0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dbgs(x) #x &lt;&lt; <span class="meta-string">" = "</span> &lt;&lt; x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dbgs2(x, y) dbgs(x) &lt;&lt; <span class="meta-string">", "</span> &lt;&lt; dbgs(y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dbgs3(x, y, z) dbgs2(x, y) &lt;&lt; <span class="meta-string">", "</span> &lt;&lt; dbgs(z)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dbgs4(w, x, y, z) dbgs3(w, x, y) &lt;&lt; <span class="meta-string">", "</span> &lt;&lt; dbgs(z)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dbga(x, n) &#123;printf(#x);for (int i = 1;i &lt;= n;i++)printf(<span class="meta-string">"%d "</span>, x[i]);printf(<span class="meta-string">"\n"</span>);&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> heap priority_queue</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mst(s, x) memset(s, x, sizeof(s))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l+r)&gt;&gt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi  first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se  second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb  push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pf  push_front</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ppb pop_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ppf pop_front</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp  make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> unq(x) x.erase(unique(x.begin(),x.end()),x.end())</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//segment tree</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls  ((cnt&lt;&lt;1))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs  ((cnt&lt;&lt;1)|1)</span></span><br><span class="line"><span class="comment">//splay</span></span><br><span class="line"><span class="comment">//#define ls  ch[x][0]</span></span><br><span class="line"><span class="comment">//#define rs  ch[x][1]</span></span><br><span class="line"><span class="comment">//#define key ch[ch[root][1]][0]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">400005</span>*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------- END OF HEADERS --------//</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//#define ONLINE_JUDGE</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"input.txt"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="comment">//freopen("output.txt", "w", stdout);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    work();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    freopen(<span class="string">"CON"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="comment">//system("pause");</span></span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">'\n'</span>),getchar(),getchar();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><h2 id="树状数组"><a href="#树状数组" class="headerlink" title="树状数组"></a>树状数组</h2><h2 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h2><h3 id="1-李超树"><a href="#1-李超树" class="headerlink" title="1.李超树"></a>1.李超树</h3><p>给出 $m$ 条直线 $y=kx+b$ 询问在整点 $x’$ 上最大的 $y’$ 是多少。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> K[N*<span class="number">4</span>],B[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">bool</span> cov[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cov[cnt]=K[cnt]=B[cnt]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span>;</span><br><span class="line">    build(l,mid,ls);</span><br><span class="line">    build(mid+<span class="number">1</span>,r,rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">double</span> nk,<span class="keyword">double</span> nb,<span class="keyword">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!cov[cnt])&#123;cov[cnt]=<span class="number">1</span>,K[cnt]=nk,B[cnt]=nb;<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(nk&gt;K[cnt]) swap(nk,K[cnt]),swap(nb,B[cnt]);</span><br><span class="line">    <span class="keyword">if</span>(K[cnt]*mid+B[cnt]&gt;nk*mid+nb)</span><br><span class="line">        &#123;<span class="keyword">if</span>(l!=r) insert(l,mid,nk,nb,ls);&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        swap(nk,K[cnt]),swap(nb,B[cnt]);</span><br><span class="line">        <span class="keyword">if</span>(l!=r) insert(mid+<span class="number">1</span>,r,nk,nb,rs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> Y=K[cnt]*x+B[cnt];</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> Y;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid) <span class="keyword">return</span> max(Y,query(l,mid,x,ls));</span><br><span class="line">    <span class="keyword">if</span>(x&gt; mid) <span class="keyword">return</span> max(Y,query(mid+<span class="number">1</span>,r,x,rs));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="扫描线"><a href="#扫描线" class="headerlink" title="扫描线"></a>扫描线</h3><h4 id="1-扫描线求矩形面积交"><a href="#1-扫描线求矩形面积交" class="headerlink" title="1.扫描线求矩形面积交"></a>1.扫描线求矩形面积交</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Y;</span><br><span class="line"></span><br><span class="line"><span class="comment">//线段树中第i个点表示 Y[i]~Y[i+1] 这条线段</span></span><br><span class="line">LL sum[MAXN*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> cov[MAXN*<span class="number">4</span>]; <span class="comment">//标记永久化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cov[cnt]&gt;<span class="number">0</span>) sum[cnt]=Y[r+<span class="number">1</span>]-Y[l];</span><br><span class="line">    <span class="keyword">else</span> sum[cnt]=sum[ls]+sum[rs];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> nl,<span class="keyword">int</span> nr,<span class="keyword">int</span> f,<span class="keyword">int</span> cnt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==nl&amp;&amp;r==nr)</span><br><span class="line">    &#123;</span><br><span class="line">        cov[cnt]+=f;</span><br><span class="line">        <span class="keyword">if</span>(cov[cnt]&gt;<span class="number">0</span>) sum[cnt]=(Y[r+<span class="number">1</span>]-Y[l]);</span><br><span class="line">        <span class="keyword">else</span> sum[cnt]=sum[ls]+sum[rs];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(nr&lt;=mid) update(l,mid,nl,nr,f,ls);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(nl&gt;mid) update(mid+<span class="number">1</span>,r,nl,nr,f,rs);</span><br><span class="line">    <span class="keyword">else</span> update(l,mid,nl,mid,f,ls),update(mid+<span class="number">1</span>,r,mid+<span class="number">1</span>,nr,f,rs);</span><br><span class="line">    pushup(l,r,cnt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">line</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x,y1,y2,f;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> line &amp;t)<span class="keyword">const</span>&#123;<span class="keyword">return</span> x&lt;t.x;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;line&gt; L;</span><br><span class="line">LL ans=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    n=read();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x1=read(),y1=read(); <span class="comment">//左下</span></span><br><span class="line">        <span class="keyword">int</span> x2=read(),y2=read(); <span class="comment">//右上</span></span><br><span class="line">        Y.pb(y1),Y.pb(y2);</span><br><span class="line">        L.pb(&#123;x1,y1,y2, <span class="number">1</span>&#125;);</span><br><span class="line">        L.pb(&#123;x2,y1,y2,<span class="number">-1</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(all(Y)),unq(Y),sort(all(L));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> m=Y.size()<span class="number">-2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;L.size();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        L[i].y1=lower_bound(all(Y),L[i].y1)-Y.begin();</span><br><span class="line">        L[i].y2=lower_bound(all(Y),L[i].y2)-Y.begin();</span><br><span class="line">        <span class="keyword">if</span>(i) ans+=LL(L[i].x-L[i<span class="number">-1</span>].x)*sum[<span class="number">1</span>];</span><br><span class="line">        update(<span class="number">0</span>,m,L[i].y1,L[i].y2<span class="number">-1</span>,L[i].f,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> write(ans),<span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="待补-线段树合并"><a href="#待补-线段树合并" class="headerlink" title="(待补)线段树合并"></a>(待补)线段树合并</h3><h3 id="待补-动态开点线段树"><a href="#待补-动态开点线段树" class="headerlink" title="(待补)动态开点线段树"></a>(待补)动态开点线段树</h3><h3 id="待补-ZKW线段树"><a href="#待补-ZKW线段树" class="headerlink" title="(待补)ZKW线段树"></a>(待补)ZKW线段树</h3><h3 id="待补-吉司机线段树"><a href="#待补-吉司机线段树" class="headerlink" title="(待补)吉司机线段树"></a>(待补)吉司机线段树</h3><p><a href="https://blog.csdn.net/qq_36284842/article/details/80058746" target="_blank" rel="noopener">吉司机线段树</a></p>
<h2 id="可持久化线段树-主席树"><a href="#可持久化线段树-主席树" class="headerlink" title="可持久化线段树(主席树)"></a>可持久化线段树(主席树)</h2><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><h4 id="1-静态区间Kth"><a href="#1-静态区间Kth" class="headerlink" title="1.静态区间Kth"></a>1.静态区间Kth</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n,m,cnt=<span class="number">0</span>,a[N+<span class="number">5</span>],b[N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> root[MAXN],ls[MAXN],rs[MAXN],s[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> cnt)</span></span>&#123;s[cnt]=s[ls[cnt]]+s[rs[cnt]];&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pre,<span class="keyword">int</span> &amp;rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	rt=++cnt;</span><br><span class="line">	<span class="keyword">if</span>(l==r)&#123;s[rt]=s[pre]+<span class="number">1</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(v&lt;=mid) rs[rt]=rs[pre],update(ls[pre],ls[rt],l,mid,v);</span><br><span class="line">	<span class="keyword">else</span> ls[rt]=ls[pre],update(rs[pre],rs[rt],mid+<span class="number">1</span>,r,v);</span><br><span class="line">	pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> lcnt,<span class="keyword">int</span> rcnt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">	<span class="keyword">int</span> sum=s[ls[rcnt]]-s[ls[lcnt]];</span><br><span class="line">	<span class="keyword">if</span>(k&lt;=sum) <span class="keyword">return</span> query(ls[lcnt],ls[rcnt],l,mid,k);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> query(rs[lcnt],rs[rcnt],mid+<span class="number">1</span>,r,k-sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) b[i]=a[i];</span><br><span class="line">	sort(b+<span class="number">1</span>,b+<span class="number">1</span>+n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) a[i]=lower_bound(b+<span class="number">1</span>,b+<span class="number">1</span>+n,a[i])-b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	n=read(),m=read();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) a[i]=read();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) update(root[i<span class="number">-1</span>],root[i],<span class="number">0</span>,N,a[i]);</span><br><span class="line">	<span class="keyword">while</span>(m--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> l=read(),r=read(),k=read();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,b[query(root[l<span class="number">-1</span>],root[r],<span class="number">0</span>,N,k)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="待补-2-区间修改-标记永久化-amp-历史版本询问-hdu4348"><a href="#待补-2-区间修改-标记永久化-amp-历史版本询问-hdu4348" class="headerlink" title="(待补) 2.区间修改(标记永久化) &amp; 历史版本询问 hdu4348"></a>(待补) 2.区间修改(标记永久化) &amp; 历史版本询问 hdu4348</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN (100005*50)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l+r)&gt;&gt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,cnt=<span class="number">0</span>,a[N],T=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> root[N+<span class="number">5</span>],ls[MAXN],rs[MAXN];</span><br><span class="line">LL s[MAXN],add[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> &amp;rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rt=++cnt;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;s[rt]=a[l];<span class="keyword">return</span>;&#125;</span><br><span class="line">    build(ls[rt],l,mid);</span><br><span class="line">    build(rs[rt],mid+<span class="number">1</span>,r);</span><br><span class="line">    s[rt]=s[ls[rt]]+s[rs[rt]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pre,<span class="keyword">int</span> &amp;rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> nl,<span class="keyword">int</span> nr,LL v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rt=++cnt;</span><br><span class="line">    s[rt]=s[pre]+(LL)(nr-nl+<span class="number">1</span>)*v;</span><br><span class="line">    add[rt]=add[pre];<span class="comment">//！！继承标记</span></span><br><span class="line">    <span class="keyword">if</span>(l==nl&amp;&amp;r==nr)</span><br><span class="line">    &#123;</span><br><span class="line">        ls[rt]=ls[pre];</span><br><span class="line">        rs[rt]=rs[pre];</span><br><span class="line">        add[rt]+=v;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(nl&gt;mid) ls[rt]=ls[pre],update(rs[pre],rs[rt],mid+<span class="number">1</span>,r,nl,nr,v);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(nr&lt;=mid) rs[rt]=rs[pre],update(ls[pre],ls[rt],l,mid,nl,nr,v);</span><br><span class="line">    <span class="keyword">else</span> update(ls[pre],ls[rt],l,mid,nl,mid,v),update(rs[pre],rs[rt],mid+<span class="number">1</span>,r,mid+<span class="number">1</span>,nr,v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> nl,<span class="keyword">int</span> nr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==nl&amp;&amp;r==nr) <span class="keyword">return</span> s[rt];</span><br><span class="line">    LL tmp=(LL)add[rt]*(nr-nl+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(nl&gt;mid) <span class="keyword">return</span> query(rs[rt],mid+<span class="number">1</span>,r,nl,nr)+tmp;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(nr&lt;=mid) <span class="keyword">return</span> query(ls[rt],l,mid,nl,nr)+tmp;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> query(ls[rt],l,mid,nl,mid)+query(rs[rt],mid+<span class="number">1</span>,r,mid+<span class="number">1</span>,nr)+tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt=T=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(root,<span class="number">0</span>,<span class="keyword">sizeof</span>(root));</span><br><span class="line">    <span class="built_in">memset</span>(ls,<span class="number">0</span>,<span class="keyword">sizeof</span>(ls));</span><br><span class="line">    <span class="built_in">memset</span>(rs,<span class="number">0</span>,<span class="keyword">sizeof</span>(rs));</span><br><span class="line">    <span class="built_in">memset</span>(add,<span class="number">0</span>,<span class="keyword">sizeof</span>(add));</span><br><span class="line">    <span class="built_in">memset</span>(s,<span class="number">0</span>,<span class="keyword">sizeof</span>(s));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)!=EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(f) f=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"\n"</span>),init();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">        build(root[<span class="number">0</span>],<span class="number">1</span>,n);</span><br><span class="line">        <span class="keyword">while</span>(m--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> t[<span class="number">5</span>]; <span class="built_in">scanf</span>(<span class="string">"%s"</span>,t);</span><br><span class="line">            <span class="keyword">if</span>(t[<span class="number">0</span>]==<span class="string">'C'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                T++;</span><br><span class="line">                <span class="keyword">int</span> l,r,v; <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;l,&amp;r,&amp;v);</span><br><span class="line">                update(root[T<span class="number">-1</span>],root[T],<span class="number">1</span>,n,l,r,v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(t[<span class="number">0</span>]==<span class="string">'B'</span>) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> l,r,h; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</span><br><span class="line">                <span class="keyword">if</span>(t[<span class="number">0</span>]==<span class="string">'Q'</span>) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,query(root[T],<span class="number">1</span>,n,l,r));</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(t[<span class="number">0</span>]==<span class="string">'H'</span>) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;h),<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,query(root[h],<span class="number">1</span>,n,l,r));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="待补-3-单点修改-区间Kth-树状数组套主席树"><a href="#待补-3-单点修改-区间Kth-树状数组套主席树" class="headerlink" title="(待补) 3.单点修改 区间Kth(树状数组套主席树)"></a>(待补) 3.单点修改 区间Kth(树状数组套主席树)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h2><h3 id="1-Splay"><a href="#1-Splay" class="headerlink" title="1.Splay"></a>1.Splay</h3><h3 id="2-Treap"><a href="#2-Treap" class="headerlink" title="2.Treap"></a>2.Treap</h3><h3 id="3-FHQ-treap-非旋Treap"><a href="#3-FHQ-treap-非旋Treap" class="headerlink" title="3.FHQ_treap(非旋Treap)"></a>3.FHQ_treap(非旋Treap)</h3><h3 id="待补-4-替罪羊树"><a href="#待补-4-替罪羊树" class="headerlink" title="(待补)4.替罪羊树"></a>(待补)4.替罪羊树</h3><h3 id="待补-5-可持久化平衡树"><a href="#待补-5-可持久化平衡树" class="headerlink" title="(待补)5.可持久化平衡树"></a>(待补)5.可持久化平衡树</h3><h2 id="待补-LCT"><a href="#待补-LCT" class="headerlink" title="(待补)LCT"></a>(待补)LCT</h2><h2 id="待补-可并堆"><a href="#待补-可并堆" class="headerlink" title="(待补)可并堆"></a>(待补)可并堆</h2><h2 id="单调栈-amp-单调队列"><a href="#单调栈-amp-单调队列" class="headerlink" title="单调栈 &amp; 单调队列"></a>单调栈 &amp; 单调队列</h2><h2 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h2><h3 id="1-重链剖分"><a href="#1-重链剖分" class="headerlink" title="1.重链剖分"></a>1.重链剖分</h3><h3 id="待补-2-长链剖分"><a href="#待补-2-长链剖分" class="headerlink" title="(待补)2.长链剖分"></a>(待补)2.长链剖分</h3><h2 id="RMQ-amp-二维RMQ-ST表"><a href="#RMQ-amp-二维RMQ-ST表" class="headerlink" title="RMQ &amp; 二维RMQ (ST表)"></a>RMQ &amp; 二维RMQ (ST表)</h2><h3 id="1-一维ST表"><a href="#1-一维ST表" class="headerlink" title="1.一维ST表"></a>1.一维ST表</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n,m,a[MAXN],f[MAXN][<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_st</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) f[i][<span class="number">0</span>]=a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j)&lt;=n;j++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=n;i++)</span><br><span class="line">            f[i][j]=max(f[i][j<span class="number">-1</span>],f[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k=log2(r-l+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> max(f[l][k],f[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-二维ST表"><a href="#2-二维ST表" class="headerlink" title="2.二维ST表"></a>2.二维ST表</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//询问矩形内最大值</span></span><br><span class="line"><span class="keyword">int</span> n,m,q;</span><br><span class="line"><span class="keyword">int</span> a[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> f[MAXN][MAXN][<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_st</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)</span><br><span class="line">            f[i][j][<span class="number">0</span>][<span class="number">0</span>]=a[i][j];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;x)&lt;=n;x++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;y)&lt;=m;y++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x+y==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;x)<span class="number">-1</span>&lt;=n;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;y)<span class="number">-1</span>&lt;=m;j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(x) f[i][j][x][y]=max(f[i][j][x<span class="number">-1</span>][y],</span><br><span class="line">                        f[i+(<span class="number">1</span>&lt;&lt;(x<span class="number">-1</span>))][j][x<span class="number">-1</span>][y]);</span><br><span class="line">                    <span class="keyword">else</span> f[i][j][x][y]=max(f[i][j][x][y<span class="number">-1</span>],</span><br><span class="line">                       f[i][j+(<span class="number">1</span>&lt;&lt;(y<span class="number">-1</span>))][x][y<span class="number">-1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=log2(x2-x1+<span class="number">1</span>),y=log2(y2-y1+<span class="number">1</span>);</span><br><span class="line">    x2=x2-(<span class="number">1</span>&lt;&lt;x)+<span class="number">1</span>;</span><br><span class="line">    y2=y2-(<span class="number">1</span>&lt;&lt;y)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> max(max(f[x1][y1][x][y],f[x2][y1][x][y]),</span><br><span class="line">       max(f[x1][y2][x][y],f[x2][y2][x][y]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="待补-莫队"><a href="#待补-莫队" class="headerlink" title="(待补)莫队"></a>(待补)莫队</h2><h2 id="待补-分块"><a href="#待补-分块" class="headerlink" title="(待补)分块"></a>(待补)分块</h2><h2 id="待补-CDQ分治"><a href="#待补-CDQ分治" class="headerlink" title="(待补)CDQ分治"></a>(待补)CDQ分治</h2><h2 id="待补-整体二分"><a href="#待补-整体二分" class="headerlink" title="(待补)整体二分"></a>(待补)整体二分</h2><h2 id="树套树"><a href="#树套树" class="headerlink" title="树套树"></a>树套树</h2><h3 id="1-线段树套线段树"><a href="#1-线段树套线段树" class="headerlink" title="1.线段树套线段树"></a>1.线段树套线段树</h3><h3 id="2-树状数组套主席树"><a href="#2-树状数组套主席树" class="headerlink" title="2.树状数组套主席树"></a>2.树状数组套主席树</h3><h3 id="3-线段树套平衡树"><a href="#3-线段树套平衡树" class="headerlink" title="3.线段树套平衡树"></a>3.线段树套平衡树</h3><h3 id="待补-4-平衡树套线段树"><a href="#待补-4-平衡树套线段树" class="headerlink" title="(待补)4.平衡树套线段树"></a>(待补)4.平衡树套线段树</h3><p>1.<a href="https://www.cnblogs.com/aininot260/p/9367918.html" target="_blank" rel="noopener">替罪羊树套线段树</a></p>
<h2 id="待补-KD-Tree"><a href="#待补-KD-Tree" class="headerlink" title="(待补)KD-Tree"></a>(待补)KD-Tree</h2><h2 id="待补-动态KD-Tree"><a href="#待补-动态KD-Tree" class="headerlink" title="(待补)动态KD-Tree"></a>(待补)动态KD-Tree</h2><h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="字符串哈希"><a href="#字符串哈希" class="headerlink" title="字符串哈希"></a>字符串哈希</h2><h3 id="模板-1"><a href="#模板-1" class="headerlink" title="模板"></a>模板</h3><h4 id="1-自然溢出"><a href="#1-自然溢出" class="headerlink" title="1.自然溢出"></a>1.自然溢出</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ULL BASE = <span class="number">13331</span>;</span><br><span class="line">ULL p[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;i++)</span><br><span class="line">        p[i]=p[i<span class="number">-1</span>]*BASE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">myHash</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ULL h[MAXN];</span><br><span class="line">    hash(<span class="keyword">const</span> <span class="keyword">char</span> str[]) &#123;init(str);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> str[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n=<span class="built_in">strlen</span>(str);</span><br><span class="line">        h[n]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) <span class="comment">//倒着hash i位为最低位 n为最高位 方便获取子串hash值</span></span><br><span class="line">            h[i]=h[i+<span class="number">1</span>]*BASE+str[i]-<span class="string">'A'</span>+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ULL <span class="title">get_hash</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> length)</span> <span class="comment">//从下标i开始长度为length的字串的hash值</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> h[i]-h[i+length]*p[length];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-二维矩阵hash"><a href="#2-二维矩阵hash" class="headerlink" title="2.二维矩阵hash"></a>2.二维矩阵hash</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二维hash 取两个base</span></span><br><span class="line"><span class="comment">//统计b矩阵在a矩阵中的出现次数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ULL base1 = <span class="number">13331</span>;</span><br><span class="line"><span class="keyword">const</span> ULL base2 = <span class="number">23333</span>;</span><br><span class="line">ULL p1[MAXN],p2[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p1[<span class="number">0</span>]=p2[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;i++)</span><br><span class="line">        p1[i]=p1[i<span class="number">-1</span>]*base1,</span><br><span class="line">        p2[i]=p2[i<span class="number">-1</span>]*base2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> T,n1,m1,n2,m2;</span><br><span class="line"><span class="keyword">char</span> a[MAXN][MAXN],b[MAXN][MAXN];</span><br><span class="line">ULL h[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n1;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m1;j++)</span><br><span class="line">            h[i][j]=h[i][j<span class="number">-1</span>]*base2+h[i<span class="number">-1</span>][j]*base1</span><br><span class="line">                -h[i<span class="number">-1</span>][j<span class="number">-1</span>]*base1*base2+(a[i][j]-<span class="string">'A'</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ULL <span class="title">get_hash</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> lx,<span class="keyword">int</span> ly)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  +h[x+lx<span class="number">-1</span>][y+ly<span class="number">-1</span>]</span><br><span class="line">            -h[x+lx<span class="number">-1</span>][y<span class="number">-1</span>]*p2[ly]</span><br><span class="line">            -h[x<span class="number">-1</span>][y+ly<span class="number">-1</span>]*p1[lx]</span><br><span class="line">            +h[x<span class="number">-1</span>][y<span class="number">-1</span>]*p1[lx]*p2[ly];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pre();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n1,&amp;m1);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n1;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,a[i]+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n2,&amp;m2);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n2;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,b[i]+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        init();</span><br><span class="line"></span><br><span class="line">        ULL t=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n2;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m2;j++)</span><br><span class="line">                t+=(b[i][j]-<span class="string">'A'</span>+<span class="number">1</span>)*p1[n2-i]*p2[m2-j];<span class="comment">//注意下标</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n1-n2+<span class="number">1</span>;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m1-m2+<span class="number">1</span>;j++)</span><br><span class="line">                <span class="keyword">if</span>(get_hash(i,j,n2,m2)==t)</span><br><span class="line">                    ans++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-双hash"><a href="#3-双hash" class="headerlink" title="3.双hash"></a>3.双hash</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备用 模数&amp;base</span></span><br><span class="line"><span class="comment">//const ULL MOD1 = 1610612741;</span></span><br><span class="line"><span class="comment">//const ULL MOD2 = 1222827239;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//const ULL BASE1 = 1331;</span></span><br><span class="line"><span class="comment">//const ULL BASE2 = 131;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ULL MOD1 = <span class="number">402653189</span>;</span><br><span class="line"><span class="keyword">const</span> ULL MOD2 = <span class="number">805306457</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ULL BASE1 = <span class="number">13331</span>;</span><br><span class="line"><span class="keyword">const</span> ULL BASE2 = <span class="number">23333</span>;</span><br><span class="line"></span><br><span class="line">ULL p[MAXN][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p[<span class="number">0</span>][<span class="number">0</span>]=p[<span class="number">0</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;i++) p[i][<span class="number">0</span>]=p[i<span class="number">-1</span>][<span class="number">0</span>]*BASE1%MOD1;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;i++) p[i][<span class="number">1</span>]=p[i<span class="number">-1</span>][<span class="number">1</span>]*BASE2%MOD2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">myHash</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ULL h[MAXN][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> s[],<span class="keyword">int</span> n=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        n=<span class="built_in">strlen</span>(s),h[n][<span class="number">0</span>]=h[n][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) h[i][<span class="number">0</span>]=(h[i+<span class="number">1</span>][<span class="number">0</span>]*BASE1%MOD1+s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%MOD1;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) h[i][<span class="number">1</span>]=(h[i+<span class="number">1</span>][<span class="number">1</span>]*BASE2%MOD2+s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%MOD2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">upr <span class="title">get_hash</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ((h[pos][<span class="number">0</span>]-h[pos+length][<span class="number">0</span>]*p[length][<span class="number">0</span>]%MOD1)+MOD1)%MOD1,</span><br><span class="line">            ((h[pos][<span class="number">1</span>]-h[pos+length][<span class="number">1</span>]*p[length][<span class="number">1</span>]%MOD2)+MOD2)%MOD2</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">upr <span class="title">make_hash</span><span class="params">(<span class="keyword">char</span> s[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=<span class="built_in">strlen</span>(s);</span><br><span class="line">    upr ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        ans.fi=(ans.fi*BASE1%MOD1+s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%MOD1;</span><br><span class="line">        ans.se=(ans.se*BASE2%MOD2+s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%MOD2;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><p><a href="https://oi-wiki.org/string/kmp/" target="_blank" rel="noopener">前缀函数与 KMP 算法 OI Wiki    
</a></p>
<h3 id="模板-2"><a href="#模板-2" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> kmp</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> a;</span><br><span class="line">    <span class="keyword">int</span> n,nx[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_nx</span><span class="params">(<span class="built_in">string</span> &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a=str,n=str.length(),nx[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> j=nx[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">while</span>(j&amp;&amp;a[i]!=a[j]) j=nx[j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(a[i]==a[j]) j++;</span><br><span class="line">            nx[i]=j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; match(<span class="built_in">string</span> &amp;b,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pos=&#123;&#125;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> m=b.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(j&amp;&amp;b[i]!=a[j]) j=nx[j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(b[i]==a[j]) j++;</span><br><span class="line">            <span class="keyword">if</span>(j==n) pos.pb(i-n+<span class="number">1</span>),j=nx[j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><h4 id="1-求字符串的最小循环节"><a href="#1-求字符串的最小循环节" class="headerlink" title="1.求字符串的最小循环节"></a>1.求字符串的最小循环节</h4><p>设字符串长度为 $N$ 下标从0开始，设 $L=N-next[N-1]$，若 $N$ % $L=0$则存在最小循环节且长度为 $L$，否则最少需要补充 $N-N$ % $L$ 个字符串使其存在循环节。</p>
<p>若求一个字符串的所有循环节则需要不断跳 $nx[j-1]$ 直到 $j$ 变为 $0$， 因为最小循环节不一定能构造出所有可行的循环节，如字符串 $ababaaaabab$ 中 $7$ 和 $9$ 都是一个可行的循环节。</p>
<h4 id="2-求字符串-S-每一个前缀在字符串-T-中的出现次数"><a href="#2-求字符串-S-每一个前缀在字符串-T-中的出现次数" class="headerlink" title="2.求字符串 $S$ 每一个前缀在字符串 $T$ 中的出现次数"></a>2.求字符串 $S$ 每一个前缀在字符串 $T$ 中的出现次数</h4><p>将字符串 $S$ 和 $T$ 用不出现在两个字符串内的字符(如’#’)拼接起来，对于 $i&gt;=n+1$ 的 $nx[i]$ 用以下代码计算。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans(n + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) ans[nx[i]]++;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) ans[nx[i - <span class="number">1</span>]] += ans[i];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) ans[i]++;</span><br></pre></td></tr></table></figure>

<h2 id="扩展kmp"><a href="#扩展kmp" class="headerlink" title="扩展kmp"></a>扩展kmp</h2><p>扩展kmp可在线性时间复杂度内求解字符串 $S$ 的每一个后缀与字符串 $T$ 的最长公共前缀。</p>
<p>$next[i]$ 表示 $T[1..m]$ 与 $T[i…m]$ 的最长公共前缀</p>
<p>$ext[i]$ 表示 $S$ 的后缀 $S[i…n]$ 与字符串 $T$ 的最长公共前缀</p>
<h3 id="资料-1"><a href="#资料-1" class="headerlink" title="资料"></a>资料</h3><p><a href="https://segmentfault.com/a/1190000008663857" target="_blank" rel="noopener">扩展KMP算法</a></p>
<h3 id="模板-3"><a href="#模板-3" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> exkmp <span class="comment">//字符串下标从0开始</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> T;</span><br><span class="line">    <span class="keyword">int</span> m,nx[MAXN],ext[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_nx</span><span class="params">(<span class="built_in">string</span> &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a=<span class="number">0</span>,p=<span class="number">0</span>;</span><br><span class="line">        m=str.length(),nx[<span class="number">0</span>]=m,T=str;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=p||i+nx[i-a]&gt;=p)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;=p) p=i;</span><br><span class="line">                <span class="keyword">while</span>(p&lt;m&amp;&amp;T[p]==T[p-i]) p++;</span><br><span class="line">                nx[i]=p-i,a=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> nx[i]=nx[i-a];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_ext</span><span class="params">(<span class="built_in">string</span> &amp;S)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a=<span class="number">0</span>,p=<span class="number">0</span>,n=S.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=p||i+nx[i-a]&gt;=p)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;=p) p=i;</span><br><span class="line">                <span class="keyword">while</span>(p&lt;n&amp;&amp;p-i&lt;m&amp;&amp;S[p]==T[p-i]) p++;</span><br><span class="line">                ext[i]=p-i,a=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> ext[i]=nx[i-a];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="字符串最小表示法"><a href="#字符串最小表示法" class="headerlink" title="字符串最小表示法"></a>字符串最小表示法</h2><h3 id="循环同构"><a href="#循环同构" class="headerlink" title="循环同构"></a>循环同构</h3><p>当字符串 $S$ 中可以选定一个位置 $i$ 满足<br>$$ S[i…n] + S[1…i-1] = T $$<br>则称字符串 $S$ 与 $T$ 循环同构。</p>
<h3 id="最小表示"><a href="#最小表示" class="headerlink" title="最小表示"></a>最小表示</h3><p>与字符串 $S$ 循环同构的字符串中字典序最小(大)的字符串，判断两个字符串是否循环同构时可以求出它们最小表示并比较。</p>
<h3 id="资料-2"><a href="#资料-2" class="headerlink" title="资料"></a>资料</h3><p><a href="https://oi-wiki.org/string/minimal-string/#simple" target="_blank" rel="noopener">最小表示法 OI Wiki</a></p>
<h3 id="模板-4"><a href="#模板-4" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_min_rep</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=s.length();</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">1</span>,k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;n&amp;&amp;j&lt;n&amp;&amp;k&lt;n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> l=(i+k)%n,r=(j+k)%n;</span><br><span class="line">        <span class="keyword">if</span>(s[l]==s[r]) k++;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s[l]&gt;s[r]?(i+=k+<span class="number">1</span>):(j+=k+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(i==j) j++;</span><br><span class="line">            k=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min(i,j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_max_rep</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=s.length();</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">1</span>,k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;n&amp;&amp;j&lt;n&amp;&amp;k&lt;n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> l=(i+k)%n,r=(j+k)%n;</span><br><span class="line">        <span class="keyword">if</span>(s[l]==s[r]) k++;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s[l]&lt;s[r]?(i+=k+<span class="number">1</span>):(j+=k+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(i==j) j++;</span><br><span class="line">            k=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min(i,j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="manacher"><a href="#manacher" class="headerlink" title="manacher"></a>manacher</h2><p>$d1[i]$ 代表以 $S[i]$ 为中心的最长奇回文的长度，$d2[i]$ 代表以 $S[i]$ ~ $S[i+1]$ 中间的空位开始的最长偶回文的长度。<br>注意 $d1$ $d2$ 均代表的是回文串的长度，而非回文串的<em>半径</em>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> manacher</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> p[MAXN*<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">string</span> a;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="built_in">string</span> &amp;s,<span class="keyword">int</span> d1[],<span class="keyword">int</span> d2[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a.clear(),a.pb(<span class="string">'$'</span>),a.pb(<span class="string">'#'</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.size();i++)</span><br><span class="line">            a.pb(s[i]),a.pb(<span class="string">'#'</span>);</span><br><span class="line">        a.pb(<span class="string">'\0'</span>);</span><br><span class="line">        <span class="keyword">int</span> n=a.size()<span class="number">-1</span>,id=<span class="number">0</span>,mx=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(mx&gt;i) p[i]=min(p[<span class="number">2</span>*id-i],mx-i<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> p[i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(a[i+p[i]]==a[i-p[i]]) p[i]++;</span><br><span class="line">            <span class="keyword">if</span>(i+p[i]<span class="number">-1</span>&gt;mx) mx=i+p[i]<span class="number">-1</span>,id=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.size();i++)   d1[i]=p[(i+<span class="number">1</span>)*<span class="number">2</span>]<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.size()<span class="number">-1</span>;i++) d2[i]=p[(i+<span class="number">1</span>)*<span class="number">2</span>+<span class="number">1</span>]<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h2><p>一个状态的 $fail$ 连向的是这个状态在自动机($Trie$)上的最长真后缀。 </p>
<h3 id="1-求以文本串每个位置匹配的模式串个数"><a href="#1-求以文本串每个位置匹配的模式串个数" class="headerlink" title="1.求以文本串每个位置匹配的模式串个数"></a>1.求以文本串每个位置匹配的模式串个数</h3><p>定义 $f(i)$ 为文本串以 $S[i]$ 为最后一个字符所能匹配到的模式串的个数，以下是求 $f(i)$ 的模板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> ACM</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> SZ=<span class="number">26</span>;</span><br><span class="line">    <span class="keyword">int</span> root,cnt;</span><br><span class="line">    <span class="keyword">int</span> nx[N][SZ],fail[N],s[N];</span><br><span class="line">    <span class="comment">//s表示该节点能匹配多少个模式串</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;SZ;i++)</span><br><span class="line">            nx[cnt][i]=<span class="number">0</span>;</span><br><span class="line">        fail[cnt]=s[cnt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;cnt=<span class="number">0</span>,root=newnode();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n=s.length(),now=root;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!nx[now][s[i]-<span class="string">'a'</span>])</span><br><span class="line">                nx[now][s[i]-<span class="string">'a'</span>]=newnode();</span><br><span class="line">            now=nx[now][s[i]-<span class="string">'a'</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        s[now]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        fail[root]=root;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;SZ;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!nx[root][i]) nx[root][i]=root;</span><br><span class="line">            <span class="keyword">else</span> fail[nx[root][i]]=root,q.push(nx[root][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> now=q.front(); q.pop();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;SZ;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(nx[now][i])</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[nx[now][i]]=nx[fail[now]][i];</span><br><span class="line">                    s[nx[now][i]]+=s[fail[nx[now][i]]];</span><br><span class="line">                    <span class="comment">//继承fail的s(结尾)</span></span><br><span class="line">                    q.push(nx[now][i]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> nx[now][i]=nx[fail[now]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//f[i]代表以i为结尾能匹配的模式串的个数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">match</span><span class="params">(<span class="built_in">string</span> &amp;s,LL f[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> now=root,n=s.length(),t;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            now=nx[now][s[i]-<span class="string">'a'</span>];</span><br><span class="line">            f[i]=s[t];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-求每个模式串的出现次数"><a href="#2-求每个模式串的出现次数" class="headerlink" title="2.求每个模式串的出现次数"></a>2.求每个模式串的出现次数</h3><p>在自动机上记录每个状态能被文本串到达的次数，匹配完后让每个节点和他的 $fail$ 节点连边建成 $fail$ 树，统计作为模式串结尾的节点的子树中有多少次匹配。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> K=<span class="number">26</span>;</span><br><span class="line"><span class="keyword">namespace</span> ACM</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> root,cnt;</span><br><span class="line">    <span class="keyword">int</span> nx[N][K],fail[N],add[N];</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; id[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x=++cnt;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">            nx[cnt][i]=<span class="number">0</span>;</span><br><span class="line">        fail[cnt]=add[cnt]=<span class="number">0</span>,id[cnt].clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;cnt=<span class="number">0</span>,newnode(root);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s,<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n=s.length(),now=root;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> c=s[i]-<span class="string">'a'</span>;</span><br><span class="line">            <span class="keyword">if</span>(!nx[now][c])</span><br><span class="line">                newnode(nx[now][c]);</span><br><span class="line">            now=nx[now][c];</span><br><span class="line">        &#125;</span><br><span class="line">        id[now].pb(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        fail[root]=root;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!nx[root][i]) nx[root][i]=root;</span><br><span class="line">            <span class="keyword">else</span> fail[nx[root][i]]=root,q.push(nx[root][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> now=q.front();q.pop();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(nx[now][i])</span><br><span class="line">                    fail[nx[now][i]]=nx[fail[now]][i],q.push(nx[now][i]);</span><br><span class="line">                <span class="keyword">else</span> nx[now][i]=nx[fail[now]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">match</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> now=root,n=s.length(),t;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            now=nx[now][s[i]-<span class="string">'a'</span>];</span><br><span class="line">            add[now]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(<span class="keyword">int</span> x=root,<span class="keyword">char</span> c=<span class="string">'#'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; dbgs2(x,c) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;K;i++)</span><br><span class="line">            <span class="keyword">if</span>(nx[x][i])</span><br><span class="line">                debug(nx[x][i],i+<span class="string">'a'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span><span class="keyword">int</span> u,v,next;&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; e=&#123;edge()&#125;;</span><br><span class="line"><span class="keyword">int</span> pre[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;e.pb(&#123;u,v,pre[u]&#125;),pre[u]=e.size()<span class="number">-1</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> ans[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    go(u) dfs(v,ans),ACM::add[u]+=ACM::add[v];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i:ACM::id[u])</span><br><span class="line">        ans[i]+=ACM::add[u];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> ans[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=ACM::cnt;i++)</span><br><span class="line">        addedge(ACM::fail[i],i);</span><br><span class="line">    dfs(ACM::root,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans[MAXN];</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n,ACM::init();</span><br><span class="line">    fp(i,<span class="number">1</span>,n) <span class="built_in">cin</span> &gt;&gt; s,ACM::insert(s,i);</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;s,ACM::build(),ACM::match(s),solve(ans);</span><br><span class="line">    fp(i,<span class="number">1</span>,n)<span class="built_in">cout</span> &lt;&lt; ans[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h2><h3 id="数组含义"><a href="#数组含义" class="headerlink" title="数组含义"></a>数组含义</h3><p>$sa[i]$ 排名为 $i$ 的后缀的起始位置.</p>
<p>$rk[i]$ 以$i$为起点的后缀的排名。</p>
<p>$height[i]$ 排名为 $i$ 的后缀和排名为 $i-1$ 的后缀的 $LCP$。</p>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><p>$$LCP(sa_{i},sa_{j})=min{height_{i+1},…,height_{j}}$$<br>即排名为i的后缀和排名为j的后缀的LCP为 $height_{i+1},…,height_{j}$ 中的最小值</p>
<h3 id="资料-3"><a href="#资料-3" class="headerlink" title="资料"></a>资料</h3><p><a href></a></p>
<h3 id="模板-5"><a href="#模板-5" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> SA</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> sa[MAXN],c[MAXN],rk[MAXN],y[MAXN],t[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j,<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> a,b;</span><br><span class="line">        a = i+k&gt;n ? <span class="number">-1</span> : rk[i+k];</span><br><span class="line">        b = j+k&gt;n ? <span class="number">-1</span> : rk[j+k];</span><br><span class="line">        <span class="keyword">return</span> (a==b)&amp;&amp;(rk[i]==rk[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">char</span> s[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        n=<span class="built_in">strlen</span>(s+<span class="number">1</span>),m=<span class="number">256</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) rk[i]=s[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=m;i++) c[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[rk[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++) c[i]+=c[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--) sa[c[rk[i]]--]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>,p;k&lt;n;k=k&lt;&lt;<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            p=<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//y[]用来暂存第二关键字排序的结果</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;n-k;i--) y[++p]=i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(sa[i]&gt;k) y[++p]=sa[i]-k;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//按第一关键字排序</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=m;i++) c[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) c[rk[i]]++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++) c[i]+=c[i<span class="number">-1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//按y的逆序提取计数排序的结果</span></span><br><span class="line">            <span class="comment">//以保证第一关键字相同时第二关键字较小的在后面</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) t[i]=rk[y[i]];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--) sa[c[t[i]]--]=y[i];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//构建以本次排序为基准的新rk[]数组</span></span><br><span class="line">            p=y[sa[<span class="number">1</span>]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">                y[sa[i]]=cmp(sa[i],sa[i<span class="number">-1</span>],k) ? p : ++p;</span><br><span class="line">            swap(rk,y),m=p;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(p==n) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> height[MAXN];</span><br><span class="line">    <span class="comment">//height[i]代表后缀rank[i]和后缀rank[i-1]的LCP lcp(sa[i],sa[i-1])</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_height</span><span class="params">(<span class="keyword">char</span> s[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j,k=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(k) k--;</span><br><span class="line">            <span class="keyword">int</span> j=sa[rk[i]<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">while</span>(s[i+k]==s[j+k]) k++;</span><br><span class="line">            height[rk[i]]=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="统计字符串中相同的子串的对数-或-字符串中每一对后缀的LCP之和"><a href="#统计字符串中相同的子串的对数-或-字符串中每一对后缀的LCP之和" class="headerlink" title="统计字符串中相同的子串的对数 或 字符串中每一对后缀的LCP之和"></a>统计字符串中相同的子串的对数 或 字符串中每一对后缀的LCP之和</h3><p>若用 $T_{i}$ 表示字符串从i开始的后缀，相同子串对数等价于求</p>
<p>$$\sum_{i=1}^{n}\sum_{j=1}^{i-1}lcp(T_{i},T_{j})$$</p>
<p>即字符串中任意两个后缀的 $lcp$ 之和</p>
<p>考虑后缀 $T_{sa_{i}}$ 和排名小于它的后缀的 $lcp$ 之和 $S_{sa_{i}}$</p>
<p>$$S_{sa_{i}}=\sum_{j=1}^{i}min{height_{j}…height_{i}}$$</p>
<p>用单调栈维护以下每个 $height_{j}$ 作为最小值的范围和它的贡献即可 $O(n)$ 来求 $\sum_{i=1}^{n}S_{sa_{i}}$</p>
<h4 id="模板-6"><a href="#模板-6" class="headerlink" title="模板"></a>模板</h4><p>配合上面的SA板子食用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">myStack</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">stack</span>&lt;lpr&gt; s1;</span><br><span class="line">    <span class="built_in">stack</span>&lt;LL &gt; s2;</span><br><span class="line">    LL sum;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(lpr p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(p&lt;s1.top())</span><br><span class="line">        &#123;</span><br><span class="line">            sum-=s2.top();</span><br><span class="line">            s1.pop(),s2.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        s2.push(p.fi*(p.se-s1.top().se));</span><br><span class="line">        s1.push(p);</span><br><span class="line">        sum+=s2.top();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(!s1.empty())s1.pop();</span><br><span class="line">        <span class="keyword">while</span>(!s2.empty())s2.pop();</span><br><span class="line">        s1.push(&#123;<span class="number">0</span>,<span class="number">0</span>&#125;),s2.push(<span class="number">0</span>),sum=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;stk;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ans=<span class="number">0</span>;</span><br><span class="line">    stk.init();</span><br><span class="line">    fp(i,<span class="number">1</span>,n) stk.push(&#123;SA::height[i],i&#125;),ans+=stk.sum;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数学-amp-数论"><a href="#数学-amp-数论" class="headerlink" title="数学 &amp; 数论"></a>数学 &amp; 数论</h1><h2 id="GCD-amp-EXGCD"><a href="#GCD-amp-EXGCD" class="headerlink" title="GCD &amp; EXGCD"></a>GCD &amp; EXGCD</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">## ##</span><br><span class="line">## 快速幂 ##</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="function">LL <span class="title">fpow</span><span class="params">(LL x,LL k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LL ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>) ans=ans*x%MOD;</span><br><span class="line">        x=x*x%MOD,k=k&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="因子求和"><a href="#因子求和" class="headerlink" title="因子求和"></a>因子求和</h2><p>若X分解质因数的结果是<br>$$p_1^{c_1}p_2^{c_2}…p_n^{c_n}$$<br>那么X所有因子的和就是<br>$$(1+p_1^1+…+p_1^{c_1})(1+p_2^1+…+p_2^{c_2})…(1+p_n^1+p_n^2+…+p_n^{c_n})$$<br>等比数列求和即可，注意下 $1-p$ 和模数互质的情况，这时<br>$$(1+p^1+p^2+…+p^n) \equiv  (n+1) $$</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求a^b的所有因子之和</span></span><br><span class="line"><span class="function">LL <span class="title">inv</span><span class="params">(LL x)</span></span>&#123;<span class="keyword">return</span> fpow(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">LL a,b;</span><br><span class="line"><span class="built_in">vector</span>&lt;lpr&gt; p;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a=read(),b=read();</span><br><span class="line">    <span class="keyword">if</span>(a==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"1\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(a==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"1\n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;(LL)i&lt;=a;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        LL cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(a%i==<span class="number">0</span>) a/=i,cnt++;</span><br><span class="line">        <span class="keyword">if</span>(cnt) p.pb(&#123;i,cnt*b&#125;);</span><br><span class="line">        <span class="keyword">if</span>(a==<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LL ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x:p)</span><br><span class="line">    &#123;</span><br><span class="line">        LL t=x.fi,cnt=x.se;</span><br><span class="line">        <span class="keyword">if</span>((<span class="number">1</span>-t)%MOD==<span class="number">0</span>) ans=ans*(cnt+<span class="number">1</span>)%MOD;</span><br><span class="line">        <span class="keyword">else</span> ans=(ans*(<span class="number">1</span>-fpow(t,cnt+<span class="number">1</span>))%MOD*inv(<span class="number">1</span>-t)%MOD+MOD)%MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    write(ans),<span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性筛素数"><a href="#线性筛素数" class="headerlink" title="线性筛素数"></a>线性筛素数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; prime;</span><br><span class="line"><span class="keyword">bool</span> flag[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_prime</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    flag[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!flag[i]) prime.pb(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> p:prime)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>((LL)p*i&gt;n) <span class="keyword">break</span>;</span><br><span class="line">            flag[p*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%p==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="阶乘分解质因数"><a href="#阶乘分解质因数" class="headerlink" title="阶乘分解质因数"></a>阶乘分解质因数</h2><p>$O(n\log{n})$</p>
<h2 id="FFT"><a href="#FFT" class="headerlink" title="FFT"></a>FFT</h2><p>当所求的值可以写作<br>$$h(j)=\sum_{i=0}^{j}f(i)<em>g(j-i)$$<br>或<br>$$h(j)=\sum_{i=j+1}^{n}f(i)</em>g(i-j)$$<br>的卷积形式时，可以考虑使用 $FFT$ ，第二种类型的多项式需要翻转并扩展上下界来变成第一类的形式。 </p>
<h3 id="资料-4"><a href="#资料-4" class="headerlink" title="资料"></a>资料</h3><ol>
<li><a href="https://www.cnblogs.com/zwfymqz/p/8244902.html?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">快速傅里叶变换(FFT)详解</a></li>
<li><a href="https://oi.men.ci/fft-notes/" target="_blank" rel="noopener">FFT 学习笔记</a></li>
<li><a href="https://blog.csdn.net/qq_38891827/article/details/80281151" target="_blank" rel="noopener">FFT模板以及简单的FFT入门题总结</a></li>
</ol>
<h3 id="模板-7"><a href="#模板-7" class="headerlink" title="模板"></a>模板</h3><h4 id="1-常规"><a href="#1-常规" class="headerlink" title="1.常规"></a>1.常规</h4> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> ```c</span><br><span class="line"><span class="keyword">typedef</span> cp <span class="keyword">complex</span>&lt;<span class="keyword">double</span>&gt;;</span><br><span class="line"><span class="keyword">namespace</span> fft</span><br><span class="line">&#123;</span><br><span class="line">    cp o[<span class="number">4</span>*MAXN],oi[<span class="number">4</span>*MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            o[i] =cp(<span class="built_in">cos</span>(<span class="number">2</span>*PI/n*i),<span class="built_in">sin</span>(<span class="number">2</span>*PI/n*i));</span><br><span class="line">            oi[i]=conj(o[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transform</span><span class="params">(cp a[],<span class="keyword">const</span> <span class="keyword">int</span> n,cp o[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//二进制翻转</span></span><br><span class="line">        <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k)&lt;n)k++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> t=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;k;j++)</span><br><span class="line">                <span class="keyword">if</span>(i&amp;(<span class="number">1</span>&lt;&lt;j))</span><br><span class="line">                    t|=(<span class="number">1</span>&lt;&lt;(k-j<span class="number">-1</span>));</span><br><span class="line">            <span class="keyword">if</span>(i&lt;t) swap(a[i],a[t]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">2</span>;l&lt;=n;l*=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> m=l/<span class="number">2</span>;</span><br><span class="line">            <span class="comment">//将两个长度为 m 的序列的答案合并为长度为 l 的序列的答案</span></span><br><span class="line">            <span class="keyword">for</span>(cp *p=a;p!=a+n;p+=l)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    cp t=o[n/l*i]*p[m+i];</span><br><span class="line">                    p[m+i]=p[i]-t,p[i]+=t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dft</span> <span class="params">(cp a[],<span class="keyword">int</span> n)</span></span>&#123;transform(a,n,o);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">idft</span><span class="params">(cp a[],<span class="keyword">int</span> n)</span></span>&#123;transform(a,n,oi);<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i]/=n;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//n1 n2为多项式a1 a2系数的个数 不是最高次数(注意+1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> a1[],<span class="keyword">int</span> n1,<span class="keyword">int</span> a2[],<span class="keyword">int</span> n2,<span class="keyword">int</span> res[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n&lt;n1+n2) n=n&lt;&lt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> cp c1[<span class="number">4</span>*MAXN],c2[<span class="number">4</span>*MAXN];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt; n;i++) c1[i]=c2[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1;i++) c1[i].real(a1[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n2;i++) c2[i].real(a2[i]);</span><br><span class="line">    fft::init(n);</span><br><span class="line">    fft::dft(c1,n),fft::dft(c2,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) c1[i]*=c2[i];</span><br><span class="line">    fft::idft(c1,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1+n2<span class="number">-1</span>;i++)</span><br><span class="line">        res[i]=<span class="keyword">int</span>(<span class="built_in">floor</span>(c1[i].real()+<span class="number">0.5</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">double</span> a1[],<span class="keyword">int</span> n1,<span class="keyword">double</span> a2[],<span class="keyword">int</span> n2,<span class="keyword">double</span> res[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n&lt;n1+n2) n=n&lt;&lt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> cp c1[<span class="number">4</span>*MAXN],c2[<span class="number">4</span>*MAXN];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt; n;i++) c1[i]=c2[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1;i++) c1[i].real(a1[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n2;i++) c2[i].real(a2[i]);</span><br><span class="line">    fft::init(n);</span><br><span class="line">    fft::dft(c1,n),fft::dft(c2,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) c1[i]*=c2[i];</span><br><span class="line">    fft::idft(c1,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1+n2<span class="number">-1</span>;i++)</span><br><span class="line">        res[i]=c1[i].real();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-卡常"><a href="#2-卡常" class="headerlink" title="2.卡常"></a>2.卡常</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cp</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">double</span> r,i;</span><br><span class="line">    cp(<span class="keyword">double</span> _r = <span class="number">0</span>,<span class="keyword">double</span> _i = <span class="number">0</span>)&#123;r = _r; i = _i;&#125;</span><br><span class="line">    cp <span class="keyword">operator</span> +(<span class="keyword">const</span> cp  &amp;b)&#123;<span class="keyword">return</span> cp(r+b.r,i+b.i);&#125;</span><br><span class="line">    cp <span class="keyword">operator</span> -(<span class="keyword">const</span> cp  &amp;b)&#123;<span class="keyword">return</span> cp(r-b.r,i-b.i);&#125;</span><br><span class="line">    cp <span class="keyword">operator</span> *(<span class="keyword">const</span> cp  &amp;b)&#123;<span class="keyword">return</span> cp(r*b.r-i*b.i,r*b.i+i*b.r);&#125;</span><br><span class="line">    cp <span class="keyword">operator</span> /(<span class="keyword">const</span> <span class="keyword">int</span> &amp;n)&#123;<span class="keyword">return</span> cp(r/n,i/n);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> fft</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> R[MAXN*<span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> L=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;L)&lt;n) L++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">            R[i]=(R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(L<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transform</span><span class="params">(cp a[],<span class="keyword">const</span> <span class="keyword">int</span> n,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">            <span class="keyword">if</span>(i&lt;R[i])</span><br><span class="line">                swap(a[i],a[R[i]]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">2</span>;l&lt;=n;l=l&lt;&lt;<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> m=l/<span class="number">2</span>;</span><br><span class="line">            cp wn=cp(<span class="built_in">cos</span>(<span class="number">2</span>*PI/l),f*<span class="built_in">sin</span>(<span class="number">2</span>*PI/l));</span><br><span class="line">            <span class="keyword">for</span>(cp *p=a;p!=a+n;p+=l)</span><br><span class="line">            &#123;</span><br><span class="line">                cp w=cp(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++,w=w*wn)</span><br><span class="line">                &#123;</span><br><span class="line">                    cp t=w*p[m+i];</span><br><span class="line">                    p[m+i]=p[i]-t,p[i]=p[i]+t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dft</span> <span class="params">(cp a[],<span class="keyword">int</span> n)</span></span>&#123;transform(a,n, <span class="number">1</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">idft</span><span class="params">(cp a[],<span class="keyword">int</span> n)</span></span>&#123;transform(a,n,<span class="number">-1</span>);<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i]=a[i]/n;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">cp c1[MAXN*<span class="number">4</span>],c2[MAXN*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(LL a1[],<span class="keyword">int</span> n1,LL a2[],<span class="keyword">int</span> n2,LL res[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n&lt;n1+n2) n=n&lt;&lt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++) c1[i]=c2[i]=cp(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1;i++) c1[i]=cp(a1[i],<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n2;i++) c2[i]=cp(a2[i],<span class="number">0</span>);</span><br><span class="line">    fft::init(n);</span><br><span class="line">    fft::dft(c1,n),fft::dft(c2,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) c1[i]=c1[i]*c2[i];</span><br><span class="line">    fft::idft(c1,n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n1+n2<span class="number">-1</span>;i++)</span><br><span class="line">        res[i]=LL(<span class="built_in">floor</span>(c1[i].r+<span class="number">0.5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h2><h3 id="模板-8"><a href="#模板-8" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二进制每8为作为一个关键字</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">256</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radix_sort</span><span class="params">(<span class="keyword">int</span> a[],<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> r1[N],r2[N],r3[N],r4[N];</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> t1[MAXN],t2[MAXN];</span><br><span class="line">    mst(r1,<span class="number">0</span>),mst(r2,<span class="number">0</span>),mst(r3,<span class="number">0</span>),mst(r4,<span class="number">0</span>);</span><br><span class="line">    fp(i,<span class="number">1</span>,n)</span><br><span class="line">    &#123;</span><br><span class="line">        ++r1[(a[i]    )&amp;<span class="number">0xff</span>]; <span class="comment">//255</span></span><br><span class="line">        ++r2[(a[i]&gt;&gt;<span class="number">8</span> )&amp;<span class="number">0xff</span>];</span><br><span class="line">        ++r3[(a[i]&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>];</span><br><span class="line">        ++r4[(a[i]&gt;&gt;<span class="number">24</span>)&amp;<span class="number">0xff</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    fp(i,<span class="number">1</span>,N<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r1[i]+=r1[i<span class="number">-1</span>];</span><br><span class="line">        r2[i]+=r2[i<span class="number">-1</span>];</span><br><span class="line">        r3[i]+=r3[i<span class="number">-1</span>];</span><br><span class="line">        r4[i]+=r4[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    fp(i,<span class="number">1</span>,n)t1[i]=i;</span><br><span class="line">    fd(i,n,<span class="number">1</span>)t2[r1[(a[t1[i]]    )&amp;<span class="number">0xff</span>]--]=t1[i];</span><br><span class="line">    fd(i,n,<span class="number">1</span>)t1[r2[(a[t2[i]]&gt;&gt;<span class="number">8</span> )&amp;<span class="number">0xff</span>]--]=t2[i];</span><br><span class="line">    fd(i,n,<span class="number">1</span>)t2[r3[(a[t1[i]]&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>]--]=t1[i];</span><br><span class="line">    fd(i,n,<span class="number">1</span>)t1[r4[(a[t2[i]]&gt;&gt;<span class="number">24</span>)&amp;<span class="number">0xff</span>]--]=t2[i];</span><br><span class="line">    fp(i,<span class="number">1</span>,n)t1[i]=a[t1[i]];</span><br><span class="line">    fp(i,<span class="number">1</span>,n)a[i]=t1[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="待补-舞蹈链"><a href="#待补-舞蹈链" class="headerlink" title="(待补)舞蹈链"></a>(待补)舞蹈链</h2><h2 id="虚树"><a href="#虚树" class="headerlink" title="虚树"></a>虚树</h2><h2 id="动态二维数组"><a href="#动态二维数组" class="headerlink" title="动态二维数组"></a>动态二维数组</h2><h3 id="模板-9"><a href="#模板-9" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">array2</span> //动态二维数组</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;T&gt;&gt; a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span>&#123;a.resize(n+<span class="number">1</span>,<span class="built_in">vector</span>&lt;T&gt;(m+<span class="number">1</span>));&#125;</span><br><span class="line">    <span class="comment">//设置数组大小</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>&#123;a.swap(*(<span class="keyword">new</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;T&gt;&gt;));&#125;</span><br><span class="line">    <span class="comment">//释放空间防止MLE</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;T&gt; &amp; <span class="keyword">operator</span> [](<span class="keyword">int</span> row)&#123;<span class="keyword">return</span> a[row];&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="二分答案"><a href="#二分答案" class="headerlink" title="二分答案"></a>二分答案</h2><h3 id="模板-10"><a href="#模板-10" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binary_search_result</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, checker check)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid, ans = l;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(mid))</span><br><span class="line">            ans = mid, l = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NlogN求LIS"><a href="#NlogN求LIS" class="headerlink" title="NlogN求LIS"></a>NlogN求LIS</h2><h3 id="模板-11"><a href="#模板-11" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n,ans1,ans2;</span><br><span class="line"><span class="keyword">int</span> f1[MAXN],f2[MAXN];</span><br><span class="line"><span class="keyword">int</span> s2[MAXN],s1[MAXN];</span><br><span class="line"><span class="keyword">int</span> a[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[++n])!=EOF);n--;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) s1[i]=s2[i]=inf;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">//s[i]代表长度为i的子序列最后一个元素的最小值</span></span><br><span class="line">        <span class="keyword">int</span> j =lower_bound(s1+<span class="number">1</span>,s1+<span class="number">1</span>+n,a[i])-s1;</span><br><span class="line">        f1[i]=j,s1[j]=a[i];</span><br><span class="line">        ans1=max(ans1,f1[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> j =upper_bound(s2+<span class="number">1</span>,s2+<span class="number">1</span>+n,a[i])-s2;</span><br><span class="line">        f2[i]=j,s2[j]=a[i];</span><br><span class="line">        ans2=max(ans2,f2[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"%d\n%d\n"</span>,ans2,ans1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数位DP-记忆化搜索"><a href="#数位DP-记忆化搜索" class="headerlink" title="数位DP 记忆化搜索"></a>数位DP 记忆化搜索</h2><h3 id="模板-12"><a href="#模板-12" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">LL cnt,d[<span class="number">20</span>],f[<span class="number">20</span>][...];</span><br><span class="line"></span><br><span class="line"><span class="comment">//limit 是否有最高位限制</span></span><br><span class="line"><span class="comment">//lead  是否有前导零</span></span><br><span class="line"><span class="comment">//state 状态</span></span><br><span class="line"><span class="comment">//状态只与len之前的位有关 因此len之前的状态相同时可用记忆化来计算</span></span><br><span class="line"><span class="comment">//** 请用-1作为没算过的标记 **</span></span><br><span class="line"><span class="function">LL <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> len,<span class="keyword">bool</span> limit,<span class="keyword">bool</span> lead,<span class="keyword">int</span> state1 ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>) <span class="keyword">return</span> ...; <span class="comment">//边界值</span></span><br><span class="line">    <span class="keyword">if</span>(!lead &amp;&amp; !limit  &amp;&amp; f[len][state1][...] != <span class="number">-1</span>)  <span class="keyword">return</span> f[len][state1][...];</span><br><span class="line">    <span class="keyword">int</span> maxn=limit?d[len]:<span class="number">9</span>;</span><br><span class="line">    LL ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=maxn;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(lead&amp;&amp;i==<span class="number">0</span>)</span><br><span class="line">            ans+=dfs(len<span class="number">-1</span>,limit&amp;&amp;i==maxn,<span class="number">1</span>,...);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(....)</span><br><span class="line">                ans+=dfs(len<span class="number">-1</span>,limit&amp;&amp;i==maxn,<span class="number">0</span>,...);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!lead &amp;&amp; !limit) f[len][state1][...]=ans;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; dbgs(len) &lt;&lt; dbgs4(limit,lead,num,s) &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(LL x)</span> <span class="comment">//计算[0,x]内符合条件的数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x) d[++cnt]=x%<span class="number">10</span>,x=x/<span class="number">10</span>;</span><br><span class="line">    LL ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(...) ans+=dfs(cnt,<span class="number">1</span>,<span class="number">1</span>,...);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mst(f,<span class="number">-1</span>);</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性基"><a href="#线性基" class="headerlink" title="线性基"></a>线性基</h2><h3 id="资料-5"><a href="#资料-5" class="headerlink" title="资料"></a>资料</h3><ol>
<li><a href="https://oi.men.ci/linear-basis-notes/" target="_blank" rel="noopener">线性基学习笔记 Menci</a></li>
<li><a href="https://ouuan.github.io/%E7%BA%BF%E6%80%A7%E5%9F%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">线性基学习笔记 ouuan</a></li>
</ol>
<h3 id="性质-1"><a href="#性质-1" class="headerlink" title="性质"></a>性质</h3><ol>
<li>线性基内的元素线性无关</li>
<li>原集合的任意一个元素都可唯一的表示为线性基中若干个元素异或起来的结果</li>
<li>线性基合并只需要将一个线性基中的所有元素插入到另一个线性基中即可。</li>
</ol>
<h3 id="模板-13"><a href="#模板-13" class="headerlink" title="模板"></a>模板</h3><h4 id="1-线性基求最大异或和"><a href="#1-线性基求最大异或和" class="headerlink" title="1.线性基求最大异或和"></a>1.线性基求最大异或和</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> LinearBasis</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> mn = <span class="number">60</span>;</span><br><span class="line">    LL a[MAXN];</span><br><span class="line">    <span class="function">LL <span class="title">maxXor</span><span class="params">()</span><span class="comment">//最大异或和</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        LL ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=mn;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">            <span class="keyword">if</span>((ans^a[i])&gt;ans)</span><br><span class="line">                ans^=a[i];</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(LL x)</span><span class="comment">//插入一个数</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=mn;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">1L</span>L&lt;&lt;i)&amp;x)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(a[i]) x^=a[i];</span><br><span class="line">                <span class="keyword">else</span>&#123;a[i]=x;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(LL x)</span><span class="comment">//判断x是否可由线性基构造出来</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=mn;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">            <span class="keyword">if</span>(((<span class="number">1L</span>L&lt;&lt;i)&amp;x) &amp;&amp; a[i])</span><br><span class="line">                x^=a[i];</span><br><span class="line">        <span class="keyword">return</span> x==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-前缀线性基"><a href="#2-前缀线性基" class="headerlink" title="2.前缀线性基"></a>2.前缀线性基</h4><p>前缀线性基可以解决用给定区间内的元素所能异或出的最大和问题，本质上是贪心的选择位置更靠右的元素作为基底。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a[MAXN][<span class="number">31</span>];<span class="comment">//线性基</span></span><br><span class="line"><span class="keyword">int</span> pos[MAXN][<span class="number">31</span>];<span class="comment">//线性基中的元素在原序列中的位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=mx;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a[index][i]  =a[index<span class="number">-1</span>][i];</span><br><span class="line">        pos[index][i]=pos[index<span class="number">-1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> curp=index;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=mx;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;i)&amp;x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!a[index][i])<span class="comment">//该位上没有元素 直接插入</span></span><br><span class="line">            &#123;</span><br><span class="line">                a[index][i]=x;</span><br><span class="line">                pos[index][i]=curp;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(curp&gt;pos[index][i])<span class="comment">//当前元素作为基时位置更靠右</span></span><br><span class="line">            &#123;</span><br><span class="line">                swap(x,a[index][i]);</span><br><span class="line">                swap(curp,pos[index][i]);</span><br><span class="line">            &#125;</span><br><span class="line">            x^=a[index][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=mx;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">        <span class="keyword">if</span>(a[r][i]&amp;&amp;pos[r][i]&gt;=l)</span><br><span class="line">            <span class="keyword">if</span>((ans^a[r][i])&gt;ans)</span><br><span class="line">                ans^=a[r][i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="计算几何"><a href="#计算几何" class="headerlink" title="计算几何"></a>计算几何</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/22/temp/" data-id="cjzm1qkz700016s7kispgap46" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/08/22/test-page/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">test page</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/22/temp/">template</a>
          </li>
        
          <li>
            <a href="/2019/08/22/test-page/">test page</a>
          </li>
        
          <li>
            <a href="/2019/08/22/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>